{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h2 class="text-2xl font-bold mb-4">Tableau de bord</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
  <div class="bg-white rounded shadow p-4">
    <div class="text-gray-500">Interventions totales</div>
    <div class="text-3xl font-bold">{{ total_interventions }}</div>
  </div>
  <div class="bg-white rounded shadow p-4">
    <div class="text-gray-500">Taux de clôture</div>
    <div class="text-3xl font-bold">{{ taux_cloture|floatformat:2 }}%</div>
  </div>
  <div class="bg-white rounded shadow p-4">
    <div class="text-gray-500">Techniciens actifs</div>
    <div class="text-3xl font-bold">{{ techniciens_actifs }}</div>
  </div>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
  <div>
    <h3 class="font-semibold mb-2">Matériel par site</h3>
    <ul>
      {% for nom, nb in materiel_par_site %}
        <li>{{ nom }} : {{ nb }}</li>
      {% empty %}
        <li>Aucun site</li>
      {% endfor %}
    </ul>
  </div>
  <div>
    <h3 class="font-semibold mb-2">Interventions par type</h3>
    <ul>
      {% for t in interventions_par_type %}
        <li>{{ t.type }} : {{ t.count }}</li>
      {% empty %}
        <li>Aucun type</li>
      {% endfor %}
    </ul>
  </div>
</div>
<div class="mt-8">
  <h3 class="font-semibold mb-2">Interventions par mois</h3>
  <canvas id="chartMois" height="100"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('chartMois').getContext('2d');
const labels = [{% for m in interventions_par_mois %}'{{ m.mois }}'{% if not forloop.last %},{% endif %}{% endfor %}];
const data = [{% for m in interventions_par_mois %}{{ m.count }}{% if not forloop.last %},{% endif %}{% endfor %}];
new Chart(ctx, {
  type: 'bar',
  data: {
    labels: labels,
    datasets: [{
      label: 'Interventions/mois',
      data: data,
      backgroundColor: 'rgba(59,130,246,0.5)',
      borderColor: 'rgba(59,130,246,1)',
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    plugins: { legend: { display: false } }
  }
});
</script>
{% endblock %}